<section class="content">
  <div class="content-block">
    <div class="block-header">
      <!-- breadcrumb -->
      <app-breadcrumb [title]="panleTitle" [items]="['Appointment']" [active_item]="panleTitle"></app-breadcrumb>
    </div>
    <div class="row clearfix">
      <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
        <div class="card">
          <div class="header">
            <h2>{{panleTitle}}</h2>
          </div>
          <div class="body">
            <form class="m-4" [formGroup]="bookingForm" (ngSubmit)="$event.preventDefault()">
              <div class="row">
                <div class="col-xl-4 col-lg-4 col-md-12 col-sm-12 mb-3">
                  <mat-form-field class="example-full-width mb-3" appearance="outline">
                    <mat-label>Mobile Number</mat-label>
                    <input #filter matInput 
                      formControlName="mobileNumber" 
                      type="text" pattern="\d*" 
                      (input)="loadData()"
                      maxlength="10" minlength="10">
                  </mat-form-field>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-12 col-sm-12 mb-3">
                  <mat-form-field class="example-full-width mb-3" appearance="outline">
                    <mat-label>First name</mat-label>
                    <input matInput 
                      formControlName="firstName" 
                      (input)="loadData()" required>
                      @if (bookingForm.get('firstName')?.hasError('required')) {
                      <mat-error>
                        First name is required
                      </mat-error>
                      }
                    </mat-form-field>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-12 col-sm-12 mb-3">
                  <mat-form-field class="example-full-width mb-3" appearance="outline">
                    <mat-label>Last name</mat-label>
                    <input matInput  
                      formControlName="lastName"
                      (input)="loadData()">
                  </mat-form-field>
                  @if (bookingForm.get('lastName')?.hasError('required')) {
                    <mat-error>
                      First name is required
                    </mat-error>
                    }
                </div>
              </div>
              
              <div class="row" *ngIf="searchExisting">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                  <div class="card">
                    <div class="body overflow-auto">
                      <div class="responsive_table">
                        <table mat-table [dataSource]="dataSource" matSort class="mat-cell advance-table">
                          <!-- ID Column -->
                          <ng-container matColumnDef="name">
                            <mat-header-cell *matHeaderCellDef mat-sort-header>Name
                            </mat-header-cell>
                            <mat-cell *matCellDef="let row" [matTooltip]="row.namePrefix+' '+row.firstName+' '+row.lastName">{{row.namePrefix}}  {{row.firstName}} {{row.lastName}}</mat-cell>
                          </ng-container>
                          <!-- <ng-container matColumnDef="firstName">
                            <mat-header-cell *matHeaderCellDef>First Name
                            </mat-header-cell>
                            <mat-cell *matCellDef="let row" [matTooltip]="row.firstName"><span class="mobile-label">First Name:</span> {{row.firstName}}
                            </mat-cell>
                          </ng-container>
                          <ng-container matColumnDef="lastName">
                            <mat-header-cell *matHeaderCellDef>Last Name
                            </mat-header-cell>
                            <mat-cell *matCellDef="let row" [matTooltip]="row.lastName"><span class="mobile-label">Last Name:</span> {{row.lastName}}
                            </mat-cell>
                          </ng-container> -->
                          <ng-container matColumnDef="mobileNumber">
                            <mat-header-cell *matHeaderCellDef>Mobile
                            </mat-header-cell>
                            <mat-cell *matCellDef="let row" [matTooltip]="row.mobileNumber"> <span class="mobile-label">Mobile:</span> {{row.mobileNumber}}
                            </mat-cell>
                          </ng-container>
                          <ng-container matColumnDef="address">
                            <mat-header-cell *matHeaderCellDef>Address
                            </mat-header-cell>
                            <mat-cell *matCellDef="let row" [matTooltip]="row.address"> <span
                                class="mobile-label">Address:</span>{{row.address}}
                            </mat-cell>
                          </ng-container>
                          <ng-container matColumnDef="gender">
                            <mat-header-cell *matHeaderCellDef >Gender</mat-header-cell>
                            <mat-cell *matCellDef="let row" [matTooltip]="row.gender">
                              <span class="truncate-text"><span class="mobile-label">Gender:</span>{{row.gender}}</span>
                            </mat-cell>
                          </ng-container>
                          <ng-container matColumnDef="dob">
                            <mat-header-cell *matHeaderCellDef>DOB</mat-header-cell>
                            <mat-cell *matCellDef="let row" [matTooltip]="row.dob">
                              <span class="truncate-text"><span class="mobile-label">DOB:</span>{{row.dob | date:'MMM d, y'}}</span>
                            </mat-cell>
                          </ng-container>
                          <!-- actions -->
                          <ng-container matColumnDef="actions">
                            <mat-header-cell class="pr-0" *matHeaderCellDef>Actions</mat-header-cell>
                            <mat-cell *matCellDef="let row; let i=index;" class="pr-0">
                              <button mat-icon-button (click)="$event.preventDefault();selectCell(row)"
                                class="tbl-action-btn">
                                <app-feather-icons [icon]="'plus'" [class]="'tbl-fav-edit'"></app-feather-icons>
                              </button>
                            </mat-cell>
                          </ng-container>
                          <mat-header-row *matHeaderRowDef="displayedColumns">
                          </mat-header-row>
                          <mat-row *matRowDef="let row; columns: displayedColumns;"
                            [style.cursor]="'pointer'" matRipple>
                          </mat-row>
                        </table>
                        @if (!exampleDatabase?.isTblLoading) {
                        <div class="no-results pt-2 pl-2" [style.display]="dataSource.renderedData.length === 0 ? '' : 'none'">
                          <mat-error>
                            No History Available, Please start Fresh Registration.
                          </mat-error>
                        </div>
                        }
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-xl-2 col-lg-2 col-md-12 col-sm-12 mb-3">
                  <mat-form-field class="example-full-width mb-3" appearance="outline">
                    <mat-label>Prefix</mat-label>
                    <mat-select formControlName="namePrefix">
                      <mat-option [value]="'Mr.'">
                        Mr.
                      </mat-option>
                      <mat-option [value]="'Miss.'">
                        Miss.
                      </mat-option>
                      <mat-option [value]="'Mrs.'">
                        Mrs.
                      </mat-option>
                      <mat-option [value]="'Ms.'">
                        Ms.
                      </mat-option>
                      <mat-option [value]="'Mx.'">
                        Mx.
                      </mat-option>
                      <mat-option [value]="'Sir'">
                        Sir
                      </mat-option>
                      <mat-option [value]="'Dr.'">
                        Dr.
                      </mat-option>
                    </mat-select>
                    @if (bookingForm.get('type')?.hasError('required')) {
                    <mat-error>
                      Appointment Type is required
                    </mat-error>
                    }
                  </mat-form-field>
                </div>
                <div class="col-xl-5 col-lg-5 col-md-12 col-sm-12 mb-3">
                  <mat-form-field class="example-full-width mb-3" appearance="outline">
                    <mat-label>Gender</mat-label>
                    <mat-select formControlName="gender" required>
                      <mat-option [value]="'M'">
                        Male
                      </mat-option>
                      <mat-option [value]="'F'">
                        Female
                      </mat-option>
                      <mat-option [value]="'O'">
                        Other
                      </mat-option>
                    </mat-select>
                    @if (bookingForm.get('gender')?.hasError('required')) {
                    <mat-error>
                      Gender is required
                    </mat-error>
                    }
                  </mat-form-field>
                </div>
                <div class="col-xl-5 col-lg-5 col-md-12 col-sm-12 mb-3">
                  <mat-form-field class="example-full-width mb-3" appearance="outline">
                    <mat-label>Adhar No</mat-label>
                    <input matInput formControlName="aadharNumber" maxlength="12">
                  </mat-form-field>
                </div>
              </div>

              <div class="row">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                  <mat-form-field class="example-full-width mb-3" appearance="outline">
                    <mat-label>Address</mat-label>
                    <textarea matInput formControlName="address"></textarea>
                  </mat-form-field>
                </div>
              </div>
              <div class="row">
                <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-3">
                  <mat-form-field class="example-full-width mb-3" appearance="outline">
                    <mat-label>Date Of Birth</mat-label>
                    <input matInput [matDatepicker]="picker" formControlName="dob" required>
                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                    @if (bookingForm.get('dob')?.hasError('required')) {
                    <mat-error>
                      Please select date
                    </mat-error>
                    }
                  </mat-form-field>
                </div>
                <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-3">
                  <mat-form-field class="example-full-width mb-3" appearance="outline">
                    <mat-label>Date Of Appointment</mat-label>
                    <input matInput [matDatepicker]="picker1" formControlName="appointmentDate" required>
                    <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                    <mat-datepicker #picker1></mat-datepicker>
                    @if (bookingForm.get('appointmentDate')?.hasError('required')) {
                    <mat-error>
                      Please select a date
                    </mat-error>
                    }
                  </mat-form-field>
                </div>
              </div>
              <h2 class="card-inside-title">Appointment Details</h2>
              <div class="row">
                <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-3">
                  <mat-form-field class="example-full-width mb-3" appearance="outline">
                    <mat-label>Consulting Doctor</mat-label>
                    <mat-select formControlName="doctorId" required>
                      <mat-option *ngFor="let data of doctors$" [value]="data.employeeId">Dr. {{data.firstName}} {{data.lastName}}</mat-option>
                    </mat-select>
                    @if (bookingForm.get('doctorId')?.hasError('required')) {
                    <mat-error>
                      Select Any Doctor
                    </mat-error>
                    }
                  </mat-form-field>
                </div>
                <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-3">
                  <mat-form-field class="example-full-width mb-3" appearance="outline">
                    <mat-label>Secondary Doctor</mat-label>
                    <mat-select formControlName="secDoctorId" required>
                      <mat-option *ngFor="let data of doctors$" [value]="data.employeeId">Dr. {{data.firstName}} {{data.lastName}}</mat-option>
                    </mat-select>
                    @if (bookingForm.get('secDoctorId')?.hasError('required')) {
                    <mat-error>
                      Select Any Doctor
                    </mat-error>
                    }
                  </mat-form-field>
                </div>
              </div>
              <div class="row">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                  <mat-form-field class="example-full-width mb-3" appearance="outline">
                    <mat-label>Injury/Contion</mat-label>
                    <textarea matInput formControlName="remark"></textarea>
                  </mat-form-field>
                </div>
              </div>

              <h2 class="card-inside-title">Bed Details</h2>
              <div class="row">
                <div class="col-xl-4 col-lg-4 col-md-12 col-sm-12">
                  <mat-form-field class="example-full-width " appearance="outline">
                    <mat-label>Floor</mat-label>
                    <mat-select formControlName="floorId" required (selectionChange)="loadRooms()" >
                      <mat-option value=0>
                        Select
                      </mat-option>
                      <mat-option *ngFor="let floor of floorOptions" [value]="floor.id">{{floor.name}}
                      </mat-option>
                    </mat-select>
                    @if (bookingForm.get('floorId')?.hasError('required')) {
                      <mat-error>
                        Floor is required
                      </mat-error>
                      }
                  </mat-form-field>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-12 col-sm-12">
                  <mat-form-field class="example-full-width " appearance="outline">
                    <mat-label>Room</mat-label>
                    <mat-select formControlName="roomId" required (selectionChange)="loadBeds()">
                      <mat-option value=0>
                        Select
                      </mat-option>
                      <mat-option *ngFor="let room of roomOptions" [value]="room.id">{{room.name}}
                      </mat-option>
                    </mat-select>
                    @if (bookingForm.get('roomId')?.hasError('required')) {
                      <mat-error>
                        Room is required
                      </mat-error>
                      }
                  </mat-form-field>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-12 col-sm-12">
                  <mat-form-field class="example-full-width " appearance="outline">
                    <mat-label>Bed</mat-label>
                    <mat-select formControlName="bedId" required >
                      <mat-option value=0>
                        Select
                      </mat-option>
                      <mat-option *ngFor="let bed of bedOptions" [value]="bed.id">{{bed.name}}
                      </mat-option>
                    </mat-select>
                    @if (bookingForm.get('bedId')?.hasError('required')) {
                      <mat-error>
                        Bed is required
                      </mat-error>
                      }
                  </mat-form-field>
                </div>
              </div>
              <!-- <div class="row"> -->
                <!-- <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                  <mat-form-field class="example-full-width mb-3" appearance="outline">
                    <mat-label>Note</mat-label>
                    <textarea matInput formControlName="note"></textarea>
                  </mat-form-field>
                </div>
              </div> -->
              <!-- <div class="row">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-5">
                  <label>Upload Reports</label>
                  <app-file-upload formControlName="uploadFile"></app-file-upload>
                </div>
              </div> -->
              <div class="row">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                  <button 
                    (click)="onSubmit()"
                    class="btn-space" 
                    [disabled]="!bookingForm.valid" mat-raised-button
                    color="primary">Submit</button>
                  <button type="button" mat-raised-button color="warn" (click)="cancel()">Cancel</button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>