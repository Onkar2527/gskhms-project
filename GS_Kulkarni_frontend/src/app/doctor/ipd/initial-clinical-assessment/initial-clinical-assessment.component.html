<section class="content">
    <div class="content-block">
      <div class="block-header">
        <!-- breadcrumb -->
        <app-breadcrumb [title]="panleTitle" [items]="['Assessment']" [active_item]="panleTitle"></app-breadcrumb>
      </div>
      <div class="row clearfix">
        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
          <div class="card">
            <div class="header">
              <h2>{{panleTitle}}</h2>
            </div>
            <div class="body">
              <form class="m-4" [formGroup]="bookingForm" (ngSubmit)="$event.preventDefault()">
                <h2 class="card-inside-title">Patient Details</h2>
                <div formGroupName="patientDetails">
                  <div class="row">
                    <div class="col-xl-4 col-lg-4 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>Mobile Number</mat-label>
                        <input #filter matInput 
                          formControlName="mobileNumber" 
                          type="text" pattern="\d*" 
                          (input)="loadData()"
                          maxlength="10" minlength="10">
                      </mat-form-field>
                    </div>
                    <div class="col-xl-4 col-lg-4 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>First name</mat-label>
                        <input matInput 
                          formControlName="firstName" 
                          (input)="loadData()" required>
                          @if (bookingForm.get('patientDetails')?.get('firstName')?.hasError('required')) {
                          <mat-error>
                            First name is required
                          </mat-error>
                          }
                        </mat-form-field>
                    </div>
                    <div class="col-xl-4 col-lg-4 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>Last name</mat-label>
                        <input matInput  
                          formControlName="lastName"
                          (input)="loadData()">
                      </mat-form-field>
                      @if (bookingForm.get('patientDetails')?.get('lastName')?.hasError('required')) {
                        <mat-error>
                          First name is required
                        </mat-error>
                        }
                    </div>
                  </div>
                  
                  <div class="row" *ngIf="searchExisting">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                      <div class="card">
                        <div class="body overflow-auto">
                          <div class="responsive_table">
                            <table mat-table [dataSource]="dataSource" matSort class="mat-cell advance-table">
                              <!-- ID Column -->
                              <ng-container matColumnDef="name">
                                <mat-header-cell *matHeaderCellDef mat-sort-header>Name
                                </mat-header-cell>
                                <mat-cell *matCellDef="let row" [matTooltip]="row.namePrefix+' '+row.firstName+' '+row.lastName">{{row.namePrefix}}  {{row.firstName}} {{row.lastName}}</mat-cell>
                              </ng-container>
                              <!-- <ng-container matColumnDef="firstName">
                                <mat-header-cell *matHeaderCellDef>First Name
                                </mat-header-cell>
                                <mat-cell *matCellDef="let row" [matTooltip]="row.firstName"><span class="mobile-label">First Name:</span> {{row.firstName}}
                                </mat-cell>
                              </ng-container>
                              <ng-container matColumnDef="lastName">
                                <mat-header-cell *matHeaderCellDef>Last Name
                                </mat-header-cell>
                                <mat-cell *matCellDef="let row" [matTooltip]="row.lastName"><span class="mobile-label">Last Name:</span> {{row.lastName}}
                                </mat-cell>
                              </ng-container> -->
                              <ng-container matColumnDef="mobileNumber">
                                <mat-header-cell *matHeaderCellDef>Mobile
                                </mat-header-cell>
                                <mat-cell *matCellDef="let row" [matTooltip]="row.mobileNumber"> <span class="mobile-label">Mobile:</span> {{row.mobileNumber}}
                                </mat-cell>
                              </ng-container>
                              <ng-container matColumnDef="address">
                                <mat-header-cell *matHeaderCellDef>Address
                                </mat-header-cell>
                                <mat-cell *matCellDef="let row" [matTooltip]="row.address"> <span
                                    class="mobile-label">Address:</span>{{row.address}}
                                </mat-cell>
                              </ng-container>
                              <ng-container matColumnDef="gender">
                                <mat-header-cell *matHeaderCellDef >Gender</mat-header-cell>
                                <mat-cell *matCellDef="let row" [matTooltip]="row.gender">
                                  <span class="truncate-text"><span class="mobile-label">Gender:</span>{{row.gender}}</span>
                                </mat-cell>
                              </ng-container>
                              <ng-container matColumnDef="dob">
                                <mat-header-cell *matHeaderCellDef>DOB</mat-header-cell>
                                <mat-cell *matCellDef="let row" [matTooltip]="row.dob">
                                  <span class="truncate-text"><span class="mobile-label">DOB:</span>{{row.dob | date:'MMM d, y'}}</span>
                                </mat-cell>
                              </ng-container>
                              <!-- actions -->
                              <ng-container matColumnDef="actions">
                                <mat-header-cell class="pr-0" *matHeaderCellDef>Actions</mat-header-cell>
                                <mat-cell *matCellDef="let row; let i=index;" class="pr-0">
                                  <button mat-icon-button (click)="$event.preventDefault();selectCell(row)"
                                    class="tbl-action-btn">
                                    <app-feather-icons [icon]="'plus'" [class]="'tbl-fav-edit'"></app-feather-icons>
                                  </button>
                                </mat-cell>
                              </ng-container>
                              <mat-header-row *matHeaderRowDef="displayedColumns">
                              </mat-header-row>
                              <mat-row *matRowDef="let row; columns: displayedColumns;"
                                [style.cursor]="'pointer'" matRipple>
                              </mat-row>
                            </table>
                            @if (!exampleDatabase?.isTblLoading) {
                            <div class="no-results pt-2 pl-2" [style.display]="dataSource.renderedData.length === 0 ? '' : 'none'">
                              <mat-error>
                                No History Available, Please start Fresh Registration.
                              </mat-error>
                            </div>
                            }
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-xl-2 col-lg-2 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>Prefix</mat-label>
                        <mat-select formControlName="namePrefix" required>
                          <mat-option [value]="'Mr.'">
                            Mr.
                          </mat-option>
                          <mat-option [value]="'Miss.'">
                            Miss.
                          </mat-option>
                          <mat-option [value]="'Mrs.'">
                            Mrs.
                          </mat-option>
                          <mat-option [value]="'Ms.'">
                            Ms.
                          </mat-option>
                          <mat-option [value]="'Mx.'">
                            Mx.
                          </mat-option>
                          <mat-option [value]="'Sir'">
                            Sir
                          </mat-option>
                          <mat-option [value]="'Dr.'">
                            Dr.
                          </mat-option>
                        </mat-select>
                        @if (bookingForm.get('patientDetails')?.get('type')?.hasError('required')) {
                        <mat-error>
                          Appointment Type is required
                        </mat-error>
                        }
                      </mat-form-field>
                    </div>
                    <div class="col-xl-5 col-lg-5 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>Gender</mat-label>
                        <mat-select formControlName="gender" required>
                          <mat-option [value]="'M'">
                            Male
                          </mat-option>
                          <mat-option [value]="'F'">
                            Female
                          </mat-option>
                          <mat-option [value]="'O'">
                            Other
                          </mat-option>
                        </mat-select>
                        @if (bookingForm.get('patientDetails')?.get('gender')?.hasError('required')) {
                        <mat-error>
                          Gender is required
                        </mat-error>
                        }
                      </mat-form-field>
                    </div>
                    <div class="col-xl-5 col-lg-5 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>Adhar No</mat-label>
                        <input matInput formControlName="aadharNumber" maxlength="12">
                      </mat-form-field>
                    </div>
                  </div>
    
                  <div class="row">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>Address</mat-label>
                        <textarea matInput formControlName="address"></textarea>
                      </mat-form-field>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>Date Of Birth</mat-label>
                        <input matInput [matDatepicker]="picker" formControlName="dob" required>
                        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                        <mat-datepicker #picker></mat-datepicker>
                        @if (bookingForm.get('patientDetails')?.get('dob')?.hasError('required')) {
                        <mat-error>
                          Please select date
                        </mat-error>
                        }
                      </mat-form-field>
                    </div>
                  </div>
                </div>
                
                <h2 class="card-inside-title">Initial Clinical Assessment</h2>
                <div class="row">
                  <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-3">
                    <mat-form-field class="example-full-width mb-3" appearance="outline">
                      <mat-label>Date</mat-label>
                      <input matInput [matDatepicker]="picker1" formControlName="admissionDate" required>
                      <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                      <mat-datepicker #picker1></mat-datepicker>
                      @if (bookingForm.get('admissionDate')?.hasError('required')) {
                      <mat-error>
                        Please select a date
                      </mat-error>
                      }
                    </mat-form-field>
                  </div>
                </div>
                <div class="row">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>Complaints</mat-label>
                        <textarea matInput formControlName="chiefComplaint"></textarea>
                      </mat-form-field>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>History Of Present Illness</mat-label>
                        <textarea matInput formControlName="presentIllnessHistory"></textarea>
                      </mat-form-field>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>Past History & Drug Allergies</mat-label>
                        <textarea matInput formControlName="pastHistory"></textarea>
                      </mat-form-field>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>Personal History</mat-label>
                        <textarea matInput formControlName="personalHistory"></textarea>
                      </mat-form-field>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>Obst/Menstrual History LPM</mat-label>
                        <textarea matInput formControlName="menstrualHistory"></textarea>
                      </mat-form-field>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>Family History</mat-label>
                        <textarea matInput formControlName="familyHistory"></textarea>
                      </mat-form-field>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>Past Treatment History</mat-label>
                        <textarea matInput formControlName="pastTreatmentHistory"></textarea>
                      </mat-form-field>
                    </div>
                  </div>

                <h2 class="card-inside-title">Vitals</h2>
                <div formArrayName="assessmentVitalDTOList"
                      *ngFor="let item of bookingForm.get('assessmentVitalDTOList')?.controls; let i = index;">
                      <div [formGroupName]="i">
                        <div class="row">
                          <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
                            <mat-form-field class="example-full-width mb-3" appearance="outline">
                              <mat-label>Pulse</mat-label>
                              <input matInput formControlName="pulse">
                            </mat-form-field>
                          </div>
                          <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
                            <mat-form-field class="example-full-width mb-3" appearance="outline">
                              <mat-label>Tempature</mat-label>
                              <input matInput formControlName="temperature">
                            </mat-form-field>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
                            <mat-form-field class="example-full-width mb-3" appearance="outline">
                              <mat-label>RR</mat-label>
                              <input matInput formControlName="rr">
                            </mat-form-field>
                          </div>
                          <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
                            <mat-form-field class="example-full-width mb-3" appearance="outline">
                              <mat-label>HR</mat-label>
                              <input matInput formControlName="hr">
                            </mat-form-field>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
                            <mat-form-field class="example-full-width mb-3" appearance="outline">
                              <mat-label>BP</mat-label>
                              <input matInput formControlName="bp">
                            </mat-form-field>
                          </div>
                          <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
                            <mat-form-field class="example-full-width mb-3" appearance="outline">
                              <mat-label>SPO2</mat-label>
                              <input matInput formControlName="spo2">
                            </mat-form-field>
                          </div>
                        </div>
                      </div>
                </div>

                <h2 class="card-inside-title">Nutritional Assessment</h2>
                <div class="row">
                  <div class="col-xl-4 col-lg-4 col-md-4 col-sm-4 mb-4">
                      <mat-checkbox color="primary" formControlName="naWN">
                        Well-nourished Normal
                      </mat-checkbox>
                  </div>
                  <div class="col-xl-4 col-lg-4 col-md-4 col-sm-4 mb-4">
                      <mat-checkbox color="primary" formControlName="naMM">
                        Mildly/moderately malnourished
                      </mat-checkbox>
                  </div>
                  <div class="col-xl-4 col-lg-4 col-md-4 col-sm-4 mb-4">
                    <mat-checkbox color="primary" formControlName="naSM">
                      Severely malnourished
                    </mat-checkbox>
                  </div>
                </div>

                <h2 class="card-inside-title">General Examination (Salient findings)</h2>
                <h5 class="card-inside-title">Built</h5>
                <div class="row">
                  <div class="col-xl-3 col-lg-4 col-md-4 col-sm-4 mb-4">
                      <mat-checkbox color="primary" formControlName="builtLean">
                        Lean
                      </mat-checkbox>
                  </div>
                  <div class="col-xl-3 col-lg-4 col-md-4 col-sm-4 mb-4">
                      <mat-checkbox color="primary" formControlName="builtAverage">
                        Average
                      </mat-checkbox>
                  </div>
                  <div class="col-xl-3 col-lg-4 col-md-4 col-sm-4 mb-4">
                    <mat-checkbox color="primary" formControlName="builtHealthy">
                      Healthy
                    </mat-checkbox>
                  </div>
                  <div class="col-xl-3 col-lg-4 col-md-4 col-sm-4 mb-4">
                    <mat-checkbox color="primary" formControlName="builtObese">
                      Obese
                    </mat-checkbox>
                  </div>
                </div>
                <h5 class="card-inside-title">Pallor</h5>
                <div class="row">
                  <div class="col-xl-2 col-lg-2 col-md-2 col-sm-4 mb-4">
                      <mat-checkbox color="primary" formControlName="pallorIcterus">
                        Icterus
                      </mat-checkbox>
                  </div>
                  <div class="col-xl-2 col-lg-2 col-md-2 col-sm-4 mb-4">
                      <mat-checkbox color="primary" formControlName="pallorCyanosis">
                        Cyanosis
                      </mat-checkbox>
                  </div>
                  <div class="col-xl-2 col-lg-2 col-md-2 col-sm-4 mb-4">
                    <mat-checkbox color="primary" formControlName="pallorClubbing">
                      Clubbing
                    </mat-checkbox>
                  </div>
                  <div class="col-xl-4 col-lg-4 col-md-4 col-sm-4 mb-4">
                    <mat-checkbox color="primary" formControlName="pallorLymphadenopathy">
                      Lymphadenopathy
                    </mat-checkbox>
                  </div>
                  <div class="col-xl-2 col-lg-2 col-md-2 col-sm-4 mb-4">
                    <mat-checkbox color="primary" formControlName="pallorOdema">
                      Odema
                    </mat-checkbox>
                  </div>
                </div>
                <div class="row">
                  <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                    <mat-form-field class="example-full-width mb-3" appearance="outline">
                      <mat-label>JVP</mat-label>
                      <textarea matInput formControlName="generalExaminationJVP"></textarea>
                    </mat-form-field>
                  </div>
                </div>

                <h2 class="card-inside-title">Systematic Examination (Salient Findings)</h2>
                <div class="row">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>RS</mat-label>
                        <textarea matInput formControlName="seRS"></textarea>
                      </mat-form-field>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>C.V.S.</mat-label>
                        <textarea matInput formControlName="seCVS"></textarea>
                      </mat-form-field>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>Abdomen</mat-label>
                        <textarea matInput formControlName="seAbdomen"></textarea>
                      </mat-form-field>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>C.N.S.</mat-label>
                        <textarea matInput formControlName="seCNS"></textarea>
                      </mat-form-field>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>Musculoskeletal System</mat-label>
                        <textarea matInput formControlName="seMusculoskeletalSystem"></textarea>
                      </mat-form-field>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>Genitalia/PR/PV/Proctoscopy</mat-label>
                        <textarea matInput formControlName="seGenitalia"></textarea>
                      </mat-form-field>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>Local Examination</mat-label>
                        <textarea matInput formControlName="localExamination"></textarea>
                      </mat-form-field>
                    </div>
                  </div>

                  <h2 class="card-inside-title">Diagnosis</h2>
                  <div class="row">
                      <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                        <mat-form-field class="example-full-width mb-3" appearance="outline">
                          <mat-label>Provisional Diagnosis</mat-label>
                          <textarea matInput formControlName="provisionalDiagnosis"></textarea>
                        </mat-form-field>
                      </div>
                    </div>
                    
                <h2 class="card-inside-title">Final Diagnosis</h2>
                <div class="row">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>Final Diagnosis</mat-label>
                        <textarea matInput formControlName="finalDiagnosis"></textarea>
                      </mat-form-field>
                    </div>
                  </div>

                  <h2 class="card-inside-title">Plan Of Care</h2>
                <div class="row">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>Medical / Surgical / Conservative management</mat-label>
                        <textarea matInput formControlName="planOfCare"></textarea>
                      </mat-form-field>
                    </div>
                  </div>

                  <h2 class="card-inside-title">Prognosis / Desired Outcome</h2>
                <div class="row">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>Final Diagnosis</mat-label>
                        <textarea matInput formControlName="desiredOutcome"></textarea>
                      </mat-form-field>
                    </div>
                  </div>

                <div class="row">
                  <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                    <button 
                      (click)="onSubmit()"
                      class="btn-space" 
                      [disabled]="!bookingForm.valid" mat-raised-button
                      color="primary">Submit</button>
                    <button type="button" mat-raised-button color="warn" (click)="cancel()">Cancel</button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>