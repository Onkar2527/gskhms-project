<section class="content">
  <div class="content-block">
    <div class="block-header">
      <!-- breadcrumb -->
      <app-breadcrumb [title]="panleTitle" [items]="['Assessment']" [active_item]="panleTitle"></app-breadcrumb>
    </div>
    <div class="row clearfix">
      <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
        <div class="card">
          <div class="header">
            <h2>{{panleTitle}}</h2>
          </div>
          <div class="body">
            <form class="m-4" [formGroup]="bookingForm" (ngSubmit)="$event.preventDefault()">
              <h2 class="card-inside-title">Patient Details</h2>
              <div formGroupName="patientDetails">
                <div class="row">
                  <div class="col-xl-4 col-lg-4 col-md-12 col-sm-12 mb-3">
                    <mat-form-field class="example-full-width mb-3" appearance="outline">
                      <mat-label>Mobile Number</mat-label>
                      <input #filter matInput 
                        formControlName="mobileNumber" 
                        type="text" pattern="\d*" 
                        (input)="loadData()"
                        maxlength="10" minlength="10">
                    </mat-form-field>
                  </div>
                  <div class="col-xl-4 col-lg-4 col-md-12 col-sm-12 mb-3">
                    <mat-form-field class="example-full-width mb-3" appearance="outline">
                      <mat-label>First name</mat-label>
                      <input matInput 
                        formControlName="firstName" 
                        (input)="loadData()" required>
                        @if (bookingForm.get('patientDetails')?.get('firstName')?.hasError('required')) {
                        <mat-error>
                          First name is required
                        </mat-error>
                        }
                      </mat-form-field>
                  </div>
                  <div class="col-xl-4 col-lg-4 col-md-12 col-sm-12 mb-3">
                    <mat-form-field class="example-full-width mb-3" appearance="outline">
                      <mat-label>Last name</mat-label>
                      <input matInput  
                        formControlName="lastName"
                        (input)="loadData()">
                    </mat-form-field>
                    @if (bookingForm.get('patientDetails')?.get('lastName')?.hasError('required')) {
                      <mat-error>
                        First name is required
                      </mat-error>
                      }
                  </div>
                </div>
                
                <div class="row" *ngIf="searchExisting">
                  <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="card">
                      <div class="body overflow-auto">
                        <div class="responsive_table">
                          <table mat-table [dataSource]="dataSource" matSort class="mat-cell advance-table">
                            <!-- ID Column -->
                            <ng-container matColumnDef="name">
                              <mat-header-cell *matHeaderCellDef mat-sort-header>Name
                              </mat-header-cell>
                              <mat-cell *matCellDef="let row" [matTooltip]="row.namePrefix+' '+row.firstName+' '+row.lastName">{{row.namePrefix}}  {{row.firstName}} {{row.lastName}}</mat-cell>
                            </ng-container>
                            <ng-container matColumnDef="mobileNumber">
                              <mat-header-cell *matHeaderCellDef>Mobile
                              </mat-header-cell>
                              <mat-cell *matCellDef="let row" [matTooltip]="row.mobileNumber"> <span class="mobile-label">Mobile:</span> {{row.mobileNumber}}
                              </mat-cell>
                            </ng-container>
                            <ng-container matColumnDef="address">
                              <mat-header-cell *matHeaderCellDef>Address
                              </mat-header-cell>
                              <mat-cell *matCellDef="let row" [matTooltip]="row.address"> <span
                                  class="mobile-label">Address:</span>{{row.address}}
                              </mat-cell>
                            </ng-container>
                            <ng-container matColumnDef="gender">
                              <mat-header-cell *matHeaderCellDef >Gender</mat-header-cell>
                              <mat-cell *matCellDef="let row" [matTooltip]="row.gender">
                                <span class="truncate-text"><span class="mobile-label">Gender:</span>{{row.gender}}</span>
                              </mat-cell>
                            </ng-container>
                            <ng-container matColumnDef="dob">
                              <mat-header-cell *matHeaderCellDef>DOB</mat-header-cell>
                              <mat-cell *matCellDef="let row" [matTooltip]="row.dob">
                                <span class="truncate-text"><span class="mobile-label">DOB:</span>{{row.dob | date:'MMM d, y'}}</span>
                              </mat-cell>
                            </ng-container>
                            <!-- actions -->
                            <ng-container matColumnDef="actions">
                              <mat-header-cell class="pr-0" *matHeaderCellDef>Actions</mat-header-cell>
                              <mat-cell *matCellDef="let row; let i=index;" class="pr-0">
                                <button mat-icon-button (click)="$event.preventDefault();selectCell(row)"
                                  class="tbl-action-btn">
                                  <app-feather-icons [icon]="'plus'" [class]="'tbl-fav-edit'"></app-feather-icons>
                                </button>
                              </mat-cell>
                            </ng-container>
                            <mat-header-row *matHeaderRowDef="displayedColumns">
                            </mat-header-row>
                            <mat-row *matRowDef="let row; columns: displayedColumns;"
                              [style.cursor]="'pointer'" matRipple>
                            </mat-row>
                          </table>
                          @if (!exampleDatabase?.isTblLoading) {
                          <div class="no-results pt-2 pl-2" [style.display]="dataSource.renderedData.length === 0 ? '' : 'none'">
                            <mat-error>
                              No History Available, Please start Fresh Registration.
                            </mat-error>
                          </div>
                          }
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-xl-2 col-lg-2 col-md-12 col-sm-12 mb-3">
                    <mat-form-field class="example-full-width mb-3" appearance="outline">
                      <mat-label>Prefix</mat-label>
                      <mat-select formControlName="namePrefix" required>
                        <mat-option [value]="'Mr.'">
                          Mr.
                        </mat-option>
                        <mat-option [value]="'Miss.'">
                          Miss.
                        </mat-option>
                        <mat-option [value]="'Mrs.'">
                          Mrs.
                        </mat-option>
                        <mat-option [value]="'Ms.'">
                          Ms.
                        </mat-option>
                        <mat-option [value]="'Mx.'">
                          Mx.
                        </mat-option>
                        <mat-option [value]="'Sir'">
                          Sir
                        </mat-option>
                        <mat-option [value]="'Dr.'">
                          Dr.
                        </mat-option>
                      </mat-select>
                      @if (bookingForm.get('patientDetails')?.get('namePrefix')?.hasError('required')) {
                      <mat-error>
                        Name Prefix is required
                      </mat-error>
                      }
                    </mat-form-field>
                  </div>
                  <div class="col-xl-5 col-lg-5 col-md-12 col-sm-12 mb-3">
                    <mat-form-field class="example-full-width mb-3" appearance="outline">
                      <mat-label>Gender</mat-label>
                      <mat-select formControlName="gender" required>
                        <mat-option [value]="'M'">
                          Male
                        </mat-option>
                        <mat-option [value]="'F'">
                          Female
                        </mat-option>
                        <mat-option [value]="'O'">
                          Other
                        </mat-option>
                      </mat-select>
                      @if (bookingForm.get('patientDetails')?.get('gender')?.hasError('required')) {
                      <mat-error>
                        Gender is required
                      </mat-error>
                      }
                    </mat-form-field>
                  </div>
                  <div class="col-xl-5 col-lg-5 col-md-12 col-sm-12 mb-3">
                    <mat-form-field class="example-full-width mb-3" appearance="outline">
                      <mat-label>Adhar No</mat-label>
                      <input matInput formControlName="aadharNumber" maxlength="12">
                    </mat-form-field>
                  </div>
                </div>
  
                <div class="row">
                  <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                    <mat-form-field class="example-full-width mb-3" appearance="outline">
                      <mat-label>Address</mat-label>
                      <textarea matInput formControlName="address"></textarea>
                    </mat-form-field>
                  </div>
                </div>
                <div class="row">
                  <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-3">
                    <mat-form-field class="example-full-width mb-3" appearance="outline">
                      <mat-label>Date Of Birth</mat-label>
                      <input matInput [matDatepicker]="picker" formControlName="dob" required>
                      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                      <mat-datepicker #picker></mat-datepicker>
                      @if (bookingForm.get('patientDetails')?.get('dob')?.hasError('required')) {
                      <mat-error>
                        Please select date
                      </mat-error>
                      }
                    </mat-form-field>
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 mb-3">
                  <mat-form-field class="example-full-width" appearance="outline">
                    <mat-label>consultant</mat-label>
                    <input matInput formControlName="consultant"/>
                  </mat-form-field>
                </div>
              </div>
              <div class="row">
                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 mb-3">
                  <mat-form-field class="example-full-width" appearance="outline">
                    <mat-label>Brought by ambulance / private vehicle bystanders</mat-label>
                    <input matInput formControlName="broughtByVehicle"/>
                  </mat-form-field>
                </div>
                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 mb-3">
                  <mat-form-field class="example-full-width" appearance="outline">
                    <mat-label>Pre hospital care yes / no if yes enumerate</mat-label>
                    <input matInput formControlName="preHospitalCareDetails"/>
                  </mat-form-field>
                </div>
              </div>
              <div class="row">
                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 mb-3">
                  <mat-form-field class="example-full-width" appearance="outline">
                    <mat-label>Allergies</mat-label>
                    <input matInput formControlName="allergies"/>
                  </mat-form-field>
                </div>
                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 mb-3">
                  <mat-form-field class="example-full-width" appearance="outline">
                    <mat-label>Last Meal</mat-label>
                    <input matInput formControlName="lastMealDetails"/>
                  </mat-form-field>
                </div>
              </div>
              <div class="row">
                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 mb-3">
                  <mat-form-field class="example-full-width" appearance="outline">
                    <mat-label>Last Meal Hours Back</mat-label>
                    <input matInput formControlName="lastMealTime"/>
                  </mat-form-field>
                </div>
                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 mb-3">
                  <mat-form-field class="example-full-width" appearance="outline">
                    <mat-label>Medications</mat-label>
                    <input matInput formControlName="medications"/>
                  </mat-form-field>
                </div>
              </div>

              <h5 class="card-inside-title">Past Medical History</h5>
              <div class="row">
                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 mb-3">
                  <mat-form-field class="example-full-width" appearance="outline">
                    <mat-label>Medical</mat-label>
                    <input matInput formControlName="pastMedicalHistory"/>
                  </mat-form-field>
                </div>
                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 mb-3">
                  <mat-form-field class="example-full-width" appearance="outline">
                    <mat-label>Surgical</mat-label>
                    <input matInput formControlName="pastSergicalHistory"/>
                  </mat-form-field>
                </div>
              </div>
              <div class="row">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                  <mat-form-field class="example-full-width mb-3" appearance="outline">
                    <mat-label>Events leading to trauma</mat-label>
                    <textarea matInput formControlName="eventsLeadingToTrauma"></textarea>
                  </mat-form-field>
                </div>
              </div>
            
              <h2 class="card-inside-title">Pain Assessment Scale</h2>
              <div class="row">
                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12">
                  <mat-form-field class="example-full-width" appearance="outline">
                    <mat-label>Pain Score</mat-label>
                    <mat-select formControlName="painScore" required>
                      <mat-option [value]="0">
                        0 - No Pain
                      </mat-option>
                      <mat-option [value]="1">
                        1 - Just noticeable pain
                      </mat-option>
                      <mat-option [value]="2">
                        2 - Mild pain
                      </mat-option>
                      <mat-option [value]="3">
                        3 - Uncomfortable pain
                      </mat-option>
                      <mat-option [value]="4">
                        4 - Annoying pain
                      </mat-option>
                      <mat-option [value]="5">
                        5 - Moderate pain
                      </mat-option>
                      <mat-option [value]="6">
                        6 - Just bearable pain
                      </mat-option>
                      <mat-option [value]="7">
                        7 - Strong pain
                      </mat-option>
                      <mat-option [value]="8">
                        8 - Severe pain
                      </mat-option>
                      <mat-option [value]="9">
                        9 - Horrible pain
                      </mat-option>
                      <mat-option [value]="10">
                        10 - Worst pain
                      </mat-option>
                    </mat-select>
                    @if (bookingForm.get('painScore')?.hasError('required')) {
                    <mat-error>
                      Pain Score is required
                    </mat-error>
                    }
                  </mat-form-field>
                </div>  
              </div>

              <h2 class="card-inside-title">Vitals</h2>
              <div formArrayName="assessmentVitalDTOList"
                    *ngFor="let item of bookingForm.get('assessmentVitalDTOList')?.controls; let i = index;">
                    <div [formGroupName]="i">
                      <div class="row">
                        <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
                          <mat-form-field class="example-full-width mb-3" appearance="outline">
                            <mat-label>Pulse</mat-label>
                            <input matInput formControlName="pulse">
                          </mat-form-field>
                        </div>
                        <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
                          <mat-form-field class="example-full-width mb-3" appearance="outline">
                            <mat-label>Tempature</mat-label>
                            <input matInput formControlName="temperature">
                          </mat-form-field>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
                          <mat-form-field class="example-full-width mb-3" appearance="outline">
                            <mat-label>RR</mat-label>
                            <input matInput formControlName="rr">
                          </mat-form-field>
                        </div>
                        <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
                          <mat-form-field class="example-full-width mb-3" appearance="outline">
                            <mat-label>HR</mat-label>
                            <input matInput formControlName="hr">
                          </mat-form-field>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
                          <mat-form-field class="example-full-width mb-3" appearance="outline">
                            <mat-label>BP</mat-label>
                            <input matInput formControlName="bp">
                          </mat-form-field>
                        </div>
                        <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12">
                          <mat-form-field class="example-full-width mb-3" appearance="outline">
                            <mat-label>SPO2</mat-label>
                            <input matInput formControlName="spo2">
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
              </div>

              <div class="row">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                  <button 
                    (click)="onSubmit()"
                    class="btn-space" 
                    [disabled]="!bookingForm.valid" mat-raised-button
                    color="primary">Submit</button>
                  <button type="button" mat-raised-button color="warn" (click)="cancel()">Cancel</button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>