<section class="content">
    <div class="content-block">
      <div class="block-header">
        <!-- breadcrumb -->
        <app-breadcrumb [title]="panleTitle" [items]="['Template']" [active_item]="panleTitle"></app-breadcrumb>
      </div>
      <div class="row clearfix">
        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
          <div class="card">
            <div class="header">
              <h2>{{panleTitle}}</h2>
            </div>
            <div class="body">
              <form class="m-4" [formGroup]="templateForm" (ngSubmit)="onSubmit()">
                <div class="row">
                  <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-3">
                    <mat-form-field class="example-full-width mb-3" appearance="outline">
                      <mat-label>Name</mat-label>
                      <input matInput formControlName="name" required>
                      @if (templateForm.get('name')?.hasError('required')) {
                      <mat-error>
                        Name is required
                      </mat-error>
                      }
                    </mat-form-field>
                  </div>
                </div>

                <div class="row" *ngIf="id">
                    <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>Medecine Name</mat-label>
                        <input #input1 type="text"
                        placeholder="Pick one"
                        aria-label="Number"
                        matInput
                        formControlName="medicineName"
                        [matAutocomplete]="auto1"
                        (input)="filterMedicine()"
                        (focus)="filterMedicine()">
                 <mat-autocomplete #auto1="matAutocomplete" (optionSelected)='pharmacySelected($event.option.value)'>
                   @for (option of filteredOptionsPharmacy; track option) {
                     <mat-option [value]="option.medecineName">{{option.medecineName}}</mat-option>
                   }
                 </mat-autocomplete>

                        @if (templateForm.get('medecineName')?.hasError('required')) {
                        <mat-error>
                          Medecine Name is required
                        </mat-error>
                        }
                      </mat-form-field>
                    </div>
                    <div class="col-xl-3 col-lg-3 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>Unit Name</mat-label>
                        <input #input type="text"
                        placeholder="Pick one"
                        aria-label="Number"
                        matInput
                        formControlName="unitName"
                        [matAutocomplete]="auto"
                        (input)="filter()"
                        (focus)="filter()">
                 <mat-autocomplete #auto="matAutocomplete">
                   @for (option of filteredOptions; track option) {
                     <mat-option [value]="option.name">{{option.name}}</mat-option>
                   }
                 </mat-autocomplete>
                        @if (templateForm.get('unitName')?.hasError('required')) {
                          <mat-error>
                            Unit Name is required
                          </mat-error>
                          }
                      </mat-form-field>
                    </div>
                    <div class="col-xl-3 col-lg-3 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>Frequency</mat-label>
                        <input matInput formControlName="frequency" required>
                        @if (templateForm.get('frequency')?.hasError('required')) {
                        <mat-error>
                          Frequency is required
                        </mat-error>
                        }
                      </mat-form-field>
                    </div>
                  </div>
                  <div class="row" *ngIf="id">
                    <div class="col-xl-3 col-lg-3 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label>Dosage </mat-label>
                        <input matInput formControlName="dosage" >
                        
                      </mat-form-field>
                    </div>
                    <div class="col-xl-3 col-lg-3 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label> Till Day  </mat-label>
                        <input matInput formControlName="tillDays" >
                        
                      </mat-form-field>
                    </div>
                    <div class="col-xl-3 col-lg-3 col-md-12 col-sm-12 mb-3">
                      <mat-form-field class="example-full-width mb-3" appearance="outline">
                        <mat-label> Quantity  </mat-label>
                        <input matInput formControlName="quantity" >
                        
                      </mat-form-field>
                    </div>
                    <div class="col-xl-3 col-lg-3 col-md-12 col-sm-12 mb-3">
                        <button type="button"  class="btn-space"  (click)="addDetails()"  mat-raised-button color="primary">Add Details</button>
                    </div>
    
                  </div>
                  <div class="row clearfix"  *ngIf="id">
                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                      <div class="card">
                        <div class="header">
                          <h2>Test Details</h2>
                          
                        </div>
                        <div class="tableBody">
                          <div class="table-responsive">
                            <table class="table display product-overview mb-30" id="support_table">
                              <thead>
                                <tr>
                                  <th>Medicine</th>
                                  <th>Unit Name</th>
                                  <th>Frequency</th>
                                  <th>Dosage</th>
                                  <th>Till Days</th>
                                  <th>Quantity</th>
                                  <th>Action</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr *ngFor="let testDetail of templateDetails$;let i =index">
                                  
                                  <td>{{testDetail.medicineName}}</td>
                                  <td>{{testDetail.unitName}}</td>
                                  <td>{{testDetail.frequency}}</td>
                                  <td>{{testDetail.dosage}}</td>
                                  <td>{{testDetail.tillDays}}</td>
                                  <td>{{testDetail.quantity}}</td>
                                  <td><button  type="button" mat-icon-button (click)="deleteTemplateDtl(testDetail.id)">
                                    <mat-icon class="col-orange">delete</mat-icon>
                                  </button></td>
                                 
                                </tr>

                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                <div class="row">
                  <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                    <button class="btn-space" [disabled]="!templateForm.valid" mat-raised-button color="primary">Submit</button>
                    <button type="button" mat-raised-button color="warn" (click)="cancel()">Cancel</button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>