<section class="content">
    <div class="content-block">
      <div class="block-header">
        <!-- breadcrumb -->
        <app-breadcrumb [title]="panleTitle" [items]="['Package Master']" [active_item]="panleTitle"></app-breadcrumb>
      </div>
      <div class="row clearfix">
        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
          <div class="card">
            <div class="header">
              <h2>{{panleTitle}}</h2>
            </div>
            <div class="body">
              <form class="m-4" [formGroup]="packageMasterForm" (ngSubmit)="onSubmit()">
                <div class="row">
                  <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-3">
                    <mat-form-field class="example-full-width mb-3" appearance="outline">
                      <mat-label>Name</mat-label>
                      <input matInput formControlName="name" required  >
                      @if (packageMasterForm.get('name')?.hasError('required')) {
                      <mat-error>
                        Name is required
                      </mat-error>
                      }
                    </mat-form-field>
                  </div>
                  <div class="col-xl-3 col-lg-3 col-md-12 col-sm-12 mb-3">
                    <mat-form-field class="example-full-width mb-3" appearance="outline">
                      <mat-label>Type</mat-label>
                      <!-- <mat-select formControlName="packageType" required > -->

                        <mat-select formControlName="deptId" required>
                          <mat-option *ngFor="let dept of departments$" [value]="dept.deptId">{{dept.deptName}}</mat-option>
                        </mat-select>
                        <!-- <mat-option value="T">
                          Lab
                        </mat-option>
                        <mat-option value="X">
                          X-Ray
                        </mat-option> -->
                      
                    </mat-form-field>
                  </div>
                  <div class="col-xl-3 col-lg-3 col-md-12 col-sm-12 mb-3">
                    <mat-form-field class="example-full-width mb-3" appearance="outline">
                      <mat-label>Charges</mat-label>
                      <input matInput formControlName="charges" required >
                      @if (packageMasterForm.get('charges')?.hasError('required')) {
                      <mat-error>
                        Charges is required
                      </mat-error>
                      }
                    </mat-form-field>
                  </div>
                </div>

                <div class="row" *ngIf="id">
                    <div class="col-xl-9 col-lg-9 col-md-12 col-sm-12 mb-3">
                        <mat-form-field class="example-full-width " appearance="outline">
                            <mat-label>Test Type</mat-label>

                            <!-- <mat-select multiple formControlName="serviceId">
                              <mat-option *ngFor="let service of serviceOptions" [value]="service.id">
                                {{ service.name }} - {{ service.charges }}
                              </mat-option>
                            </mat-select> -->

                            <mat-select multiple formControlName="serviceId">
                              <mat-option *ngFor="let data of serviceOptions" [value]="data.id">{{data.name}} - {{data.rate}}</mat-option>
                            </mat-select>

                          
                            <!-- <mat-select formControlName="serviceId" required >
                              <mat-option value="0">
                                Select
                              </mat-option>
                              <mat-option *ngFor="let service of serviceOptions" value="{{service.id}}">{{service.name}}-{{service.charges}}
                              </mat-option>
                            </mat-select> -->
                          </mat-form-field>
                        </div>
                       
                        
                        <div class="col-xl-3 col-lg-3 col-md-12 col-sm-12 mb-3">
                            <button type="button"  class="btn-space"  (click)="addPackageDetails()"  mat-raised-button color="primary">Add Details</button>
                        </div>
                        </div>
                        <div class="row clearfix"  *ngIf="id">
                            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                              <div class="card">
                                <div class="header">
                                  <h2>Services Included in Packages</h2>
                                  
                                </div>
                                <div class="tableBody">
                                  <div class="table-responsive">
                                    <table class="table display product-overview mb-30" id="support_table">
                                      <thead>
                                        <tr>
                                          <th>Service Name</th>
                                          <th>Charges</th>
                                          <th>Action</th>
                                        </tr>
                                      
                                      </thead>
                                      <tbody>
                                        <tr *ngFor="let packageDtl of packageDetails$;let i =index">
                                          <td>{{getServiceName(packageDtl.serviceId)}}</td>
                                          <td>{{packageDtl.charges}}</td>
                                          <td><button  type="button" mat-icon-button (click)="deleteServiceDtl(packageDtl.id)">
                                            <mat-icon class="col-orange">delete</mat-icon>
                                          </button></td>
                                        </tr>
                                        <tr>
                                          <td><strong>Total</strong></td>
                                          <td><strong>{{ getTotalCharges() }}</strong></td>
                                          <td></td>
                                        </tr>


                                        <!-- <tr *ngFor="let data of serviceOptions;let i =index">
                                          <td>{{getServiceName(data.id)}}</td>
                                          <td>{{data.rate}}</td>
                                          <td><button  type="button" mat-icon-button (click)="deleteServiceDtl(data.id)">
                                            <mat-icon class="col-orange">delete</mat-icon>
                                          </button></td>
                                        </tr> -->
        
                                      </tbody>
                                    </table>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                
                   
                <div class="row">
                  <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                    <button class="btn-space" [disabled]="!packageMasterForm.valid" mat-raised-button color="primary">Save</button>
                    <button type="button" mat-raised-button color="warn" (click)="cancel()">Cancel</button>
                  </div>
                </div>
               
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>